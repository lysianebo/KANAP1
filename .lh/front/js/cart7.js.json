{
    "sourceFile": "front/js/cart7.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1676993495228,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1676993512453,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,19 +13,17 @@\n     }\n }\n \n \n-\n fetch(\"http://localhost:3000/api/products\")\n    .then((res) => res.json())\n    .then((panier) => makeArticle(panier))\n \n function makeArticle(){\n for (var i = 0; i < localStorage.length; i++) {\n    console.log(localStorage.getItem(localStorage.key(i)));\n }\n-\n-    \n+  \n     //for (let i = 0; i < panier.length; i++) {\n \n       //  const item = panier[i];\n     const addArticle = document.createElement(\"article\")\n"
                },
                {
                    "date": 1676993544820,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -126,9 +126,9 @@\n }\n function DeleteToSettings(settings, item) {\n    const supprimer = document.querySelector(\".deleteItem\")\n    supprimer.addEventListener(\"click\", deleteDataFromCache)\n-   // const itemTodelete = cart.findIndex((product) =>\n+   const itemTodelete = cart.findIndex((product) =>\n    // product.id === item.id && product.color === item.color)\n     cart.splice[itemToDelete, 1]\n     displayTotalQuantity()\n     displayTotalPrice\n"
                },
                {
                    "date": 1676993559823,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -127,9 +127,9 @@\n function DeleteToSettings(settings, item) {\n    const supprimer = document.querySelector(\".deleteItem\")\n    supprimer.addEventListener(\"click\", deleteDataFromCache)\n    const itemTodelete = cart.findIndex((product) =>\n-   // product.id === item.id && product.color === item.color)\n+   product.id === item.id && product.color === item.color)\n     cart.splice[itemToDelete, 1]\n     displayTotalQuantity()\n     displayTotalPrice\n     deleteDataFromCache(item)\n@@ -137,9 +137,8 @@\n function deleteDataFromCache(item){\n const key = id //`${item.id}-${item.color}`\n localStorage.removeItem(key)\n }\n-//console.log(cart)\n const orderButton = document.querySelector(\"#order\")\n orderButton.addEventListener(\"click\", (e) => submitForm(e))\n \n function submitForm(e){\n"
                },
                {
                    "date": 1676993590724,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -201,9 +201,9 @@\n         address: address,\n         city: city,\n         email: email\n       }\n-      //  products: getIdsFromCache()\n+      products: getIdsFromCache()\n     }\n     return body\n }\n //pas besoin de faire split si seulement key et pas color\n"
                },
                {
                    "date": 1676993598036,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -201,9 +201,9 @@\n         address: address,\n         city: city,\n         email: email\n       }\n-      products: getIdsFromCache()\n+      //products: getIdsFromCache()\n     }\n     return body\n }\n //pas besoin de faire split si seulement key et pas color\n"
                },
                {
                    "date": 1676993609610,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -12,9 +12,8 @@\n     panier.push(itemObjet)\n     }\n }\n \n-\n fetch(\"http://localhost:3000/api/products\")\n    .then((res) => res.json())\n    .then((panier) => makeArticle(panier))\n \n"
                }
            ],
            "date": 1676993495228,
            "name": "Commit-0",
            "content": "const panier = []\nlet item = \"\"\n\nretrieveItemsFromCache()\npanier.forEach((item) => makeArticle(item))\n//cart.forEach((item) => displayItem(item))\nfunction retrieveItemsFromCache() {\n    const numberofItems = localStorage.length\n    for (let i = 0; i < numberofItems; i++) {\n    const item = localStorage.getItem(localStorage.key(i)) || \"\"\n    const itemObjet = JSON.parse(item)\n    panier.push(itemObjet)\n    }\n}\n\n\n\nfetch(\"http://localhost:3000/api/products\")\n   .then((res) => res.json())\n   .then((panier) => makeArticle(panier))\n\nfunction makeArticle(){\nfor (var i = 0; i < localStorage.length; i++) {\n   console.log(localStorage.getItem(localStorage.key(i)));\n}\n\n    \n    //for (let i = 0; i < panier.length; i++) {\n\n      //  const item = panier[i];\n    const addArticle = document.createElement(\"article\")\n    addArticle.classList.add(\"cart__item\")\n    addArticle.dataset.id = item.id\n    addArticle.dataset.color = item.color\n    document.getElementById(\"cart__items\").appendChild(addArticle)\n\n        const divImg = document.createElement(\"div\")\n        divImg.classList.add(\"cart__item__img\")\n        const image = document.createElement(\"img\")\n      //image.src = imageUrl\n      //image.alt = altTxt\n        divImg.appendChild(image)\n        \n        const contentDiv = document.createElement('div')\n        contentDiv.classList.add(\"cart__item__content\")\n\n            const descriptionDiv = document.createElement(\"div\")\n            descriptionDiv.classList.add(\"cart__item__content__description\")\n            \n            const h2= document.createElement(\"h2\")\n            h2.textContent = item.name\n            const p = document.createElement(\"p\")\n            p.textContent = item.color\n            const p2 = document.createElement(\"p\")\n            p2.textContent = item.price + \"€\"\n\n            const settingsDiv = document.createElement(\"div\")\n            settingsDiv.classList.add(\"cart__item__content__settings\")\n                const quantity = document.createElement(\"div\")\n                quantity.classList.add(\"cart__item__content__settings__quantity\")\n                    const quantityP = document.createElement(\"p\")\n                    quantityP.textContent =\"Qté : \"\n                    const input = document.createElement(\"input\")\n                    input.type = \"number\"\n                    input.classList.add(\"itemQuantity\")\n                    input.name =\"itemQuantity\"\n                    input.min =\"1\"\n                    input.max =\"100\"\n                    input.value = item.quantity\n                    input.addEventListener(\"input\", (e) => updatePriceQuantity(panier.id, input.value, panier)) \n                const contentDelete = document.createElement(\"div\")\n                contentDelete.classList.add(\"cart__item__content__settings__delete\")\n                    const deleteP = document.createElement(\"p\")\n                    deleteP.classList.add(\"deleItem\")\n                    deleteP.textContent =\"Supprimer \"\n                    \n                   // p.addEvenListener(\"click\", () => deleteItem(item))\n                    //DeleteToSettings()\n                    //const Delete = DeleteToSettings()\n\n             \n        appendtoArticle(addArticle, [divImg, contentDiv])\n        appendtoArticle(contentDiv, [descriptionDiv, settingsDiv])\n        appendtoArticle(settingsDiv, [quantity, contentDelete])\n\n        appendtoArticle(descriptionDiv, [h2, p, p2])\n        appendtoArticle(quantity, [quantityP, input])\n        appendtoArticle(contentDelete, [deleteP])\n\n        displayTotalQuantity()\n        displayTotalPrice()\n}\n\nfunction appendtoArticle(article, array) {\n    array.forEach(item => {\n    article.appendChild(item)\n})\n}\nfunction displayTotalPrice(){\n    const totalPrice = document.querySelector(\"#totalPrice\")\n    //const totalItemPrice = panier.reduce((total,item) => total + item.price * item.quantity, 0)\n    //totalPrice.textContent = total\n    //const total = totalPrice.textContent\n }\n function displayTotalQuantity(){\n    const totalQuantity = document.querySelector(\"#totalQuantity\")\n  // const total = panier.reduce((total,item) => total + item.quantity, 0)\n    //totalQuantity.textContent = total\n    //const totalItems = totalQuantity.textContent\n }\n function updatePriceQuantity(id, newValue, item){\n    const itemToUpdate = panier.find((item) => item.id === id)\n    itemToUpdate.quantity = Number(newValue)\n    item.quantity = itemToUpdate.quantity\n    displayTotalQuantity()\n    displayTotalPrice()\n    deleteDataFromCache(item)\n }\n\n\n\n\n \nfunction saveNewDataToCache(item){\n    const dataToSave = JSON.stringify(item)\n    const key = id//`${item.id}-${item.color}`\n    localStorage.setItem(key, dataToSave)\n}\nfunction DeleteToSettings(settings, item) {\n   const supprimer = document.querySelector(\".deleteItem\")\n   supprimer.addEventListener(\"click\", deleteDataFromCache)\n   // const itemTodelete = cart.findIndex((product) =>\n   // product.id === item.id && product.color === item.color)\n    cart.splice[itemToDelete, 1]\n    displayTotalQuantity()\n    displayTotalPrice\n    deleteDataFromCache(item)\n}\nfunction deleteDataFromCache(item){\nconst key = id //`${item.id}-${item.color}`\nlocalStorage.removeItem(key)\n}\n//console.log(cart)\nconst orderButton = document.querySelector(\"#order\")\norderButton.addEventListener(\"click\", (e) => submitForm(e))\n\nfunction submitForm(e){\ne.preventDefault() //ne pas rafraîchir\nif (cart.lenght === 0) alert (\"Sélectionnez votre canapé\")\n//return\n\n//if (formIsInvalid()) return\nif (emailIsInvalid()) return\n\nconst body = makeRequestBody()\nfetch(\"http://localhost:3000/api/products/order\",{\nmethod : \"POST\",\nbody: JSON.stringify(body),\nHeaders:{\n    \"Content-type\":\"appplication/json\"\n}\n})\n.then((res) => res.json())\n.then((data) => {\nconst orderId = data.orderId\nwindow.location.href = \"confirmation.html\" + \"?orderId=\" + orderId\n})\n.catch((err) => console.error(err))\n}\nfunction formIsInvalid(){\n   // const form = document.querySelector(\"cart__order__form\")\n   const inputs = form.querySelectorAll(\"input\")\n    inputs.forEach((input) =>{\n        if (input.value === \"\"){\n            alert(\"Vous devez compléter ce champ\")\n            return true\n        }\n        return false\n    })\n}\nfunction emailIsInvalid(){\n    const email = document.querySelector(\"#email\").value\n    const regex = /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/\n    if (regex.test(email) === false) {\n        alert (\"Votre adresse mail n'est pas valide\")\n        return true\n    }\n    return false\n}\n\n\nfunction makeRequestBody(){\n    const form = document.querySelector(\"cart__order__form\")\n    inputFirstame = document.getElementById(\"firstName\").value;\n    inputLastname = document.getElementById(\"lastName\").value;\n    inputAddress = document.getElementById(\"address\").value;\n    inputCity = document.getElementById(\"city\").value;\n    inputEmail = document.getElementById(\"email\").value;\n\n    const body = {\n    contact: {\n        firstName: firstName,\n        lastName: lastName,\n        address: address,\n        city: city,\n        email: email\n      }\n      //  products: getIdsFromCache()\n    }\n    return body\n}\n//pas besoin de faire split si seulement key et pas color\nfunction getIdsFromCache(){\n    const numberOfProducts = localStorage-length\n    const ids = []\n    for (let i = 0; i < numberOfProducts; i++){\n    const key = localStorage.key(i)\n    const id = key-split(\"-\")[0]\n    //const id = key-split(\"-\")[0]\n\n    ids.push(id)\n    }\n    return ids\n}\n"
        }
    ]
}